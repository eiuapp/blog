<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-01-08 Fri 15:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sed string</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="a" />
<link rel="stylesheet" title="Standard" href="/html/style/worg.css" type="text/css" />
<link rel="alternate stylesheet" title="Zenburn" href="/html/style/worg-zenburn.css" type="text/css" />
<link rel="alternate stylesheet" title="Classic" href="/html/style/worg-classic.css" type="text/css" />
<link rel="SHORTCUT ICON" href="/html/style/org-mode-unicorn.ico" type="image/x-icon" />
<link rel="icon" href="/html/style/org-mode-unicorn.ico" type="image/ico" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded',function() {
      document.getElementById("table-of-contents").onclick = function() {
          var elem = document.getElementById("text-table-of-contents");
          elem.style.display = elem.style.display == "block" ? "none" : "block";
      }
  });

  var url = document.location.href;
  var orgsource = url.substring(0, url.lastIndexOf("."))+".org.html";
  function show_org_source(){
      document.location.href = orgsource;
  }
</script>

<script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '//stats.orgmode.org/tracker.js', 'fathom');
fathom('set', 'siteId', 'NWSQJ');
fathom('trackPageview');
</script>
</div>
<div id="content">
<h1 class="title">sed string</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4c1403f">Post</a>
<ul>
<li><a href="#orge0f9b0f">sed string</a>
<ul>
<li><a href="#orge1ee20a">linux sed 批量替换字符串</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org4c1403f" class="outline-2">
<h2 id="org4c1403f">Post</h2>
<div class="outline-text-2" id="text-org4c1403f">
</div>
<div id="outline-container-orge0f9b0f" class="outline-3">
<h3 id="orge0f9b0f">sed string&#xa0;&#xa0;&#xa0;<span class="tag"><span class="_sed">@sed</span>&#xa0;<span class="sed">sed</span>&#xa0;<span class="linux">linux</span></span></h3>
<div class="outline-text-3" id="text-orge0f9b0f">
</div>
<div id="outline-container-orge1ee20a" class="outline-4">
<h4 id="orge1ee20a">linux sed 批量替换字符串&#xa0;&#xa0;&#xa0;<span class="tag"><span class="replace">replace</span></span></h4>
<div class="outline-text-4" id="text-orge1ee20a">
<p>
Linux下批量替换多个文件中的字符串的简单方法。
</p>
</div>

<ul class="org-ul">
<li><a id="org572a22b"></a>用sed命令可以批量替换多个文件中的字符串<br />
<div class="outline-text-5" id="text-org572a22b">
<p>
命令如下：
</p>
<div class="org-src-container">
<pre class="src src-shell">sed -i <span style="color: #daa520;">"s/&#21407;&#23383;&#31526;&#20018;/&#26032;&#23383;&#31526;&#20018;/g"</span> <span style="color: #00cdcd; font-weight: bold;">`grep &#21407;&#23383;&#31526;&#20018; -rl &#25152;&#22312;&#30446;&#24405;`</span>
</pre>
</div>


<p>
例如：我要把 charset=gb2312 替换为 charset=UTF-8，执行命令：
</p>
<div class="org-src-container">
<pre class="src src-shell">sed -i <span style="color: #daa520;">"s/charset=gb2312/charset=UTF-8/g"</span> <span style="color: #00cdcd; font-weight: bold;">`grep charset=gb2312 -rl /www`</span>
</pre>
</div>

<p>
即可。
</p>

<p>
解释一下：
</p>

<p>
-i 表示inplace edit，就地修改文件
</p>

<p>
-r 表示搜索子目录
</p>

<p>
-l 表示输出匹配的文件名
</p>

<p>
这个命令组合很强大，要注意备份文件。
</p>
</div>
</li>

<li><a id="org47d67be"></a>关于 sed 的更多说明：<br />
<div class="outline-text-5" id="text-org47d67be">
<ol class="org-ol">
<li>替换</li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">sed <span style="color: #daa520;">'y/1234567890/ABCDEFGHIJ/'</span> test_sed
</pre>
</div>

<p>
test_sed的内容是：
</p>

<pre class="example">
1234567890

2345678901

3456789012

4567890123
</pre>

<p>
执行后，test_sed的内容是：
</p>

<pre class="example">
ABCDEFGHIJ

BCDEFGHIJA

CDEFGHIJAB

DEFGHIJABC
</pre>

<p>
注意变换关系是按两个list的位置对应变换
</p>

<ol class="org-ol">
<li>替换每行所有匹配</li>
</ol>

<p>
sed 's/01/Ab/g' test_sed
</p>

<p>
1234567890
</p>

<p>
23456789Ab
</p>

<p>
3456789Ab2
</p>

<p>
456789Ab23
</p>

<p>
注意：第一行的0，1没有分别替换为A,b
</p>
</div>
</li>

<li><a id="orgb676234"></a>删除：d命令<br />
<div class="outline-text-5" id="text-orgb676234">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'2d'</span> example
</pre>
</div>

<p>
删除example文件的第二行。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'2,$d'</span> example
</pre>
</div>

<p>
删除example文件的第二行到末尾所有行。
</p>
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'$d'</span> example
</pre>
</div>

<p>
删除example文件的最后一行。
</p>
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/test/'</span>d example
</pre>
</div>

<p>
删除example文件所有包含test的行。
</p>
</div>
</li>

<li><a id="orgad22717"></a>替换：s命令<br />
<div class="outline-text-5" id="text-orgad22717">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'s/test/mytest/g'</span> example
</pre>
</div>

<p>
在整行范围内把test替换为mytest。如果没有g标记，则只有每行第一个匹配的test被替换成mytest。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #daa520;">'s/^test/mytest/p'</span> example
</pre>
</div>

<p>
(-n)选项和p标志一起使用表示只打印那些发生替换的行。也就是说，如果某一行开头的test被替换成mytest，就打印它。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'s/^192.168.0.1/&amp;localhost/'</span>example
</pre>
</div>

<p>
&amp;符号表示替换换字符串中被找到的部份。所有以192.168.0.1开头的行都会被替换成它自已加localhost，变成192.168.0.1localhost。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #daa520;">'s/\(love\)able/\1rs/p'</span> example
</pre>
</div>

<p>
love被标记为1，所有loveable会被替换成lovers，而且替换的行会被打印出来。
</p>

<p>
$ sed 's#10#100#g' example
</p>

<p>
不论什么字符，紧跟着s命令的都被认为是新的分隔符，所以，“#”在这里是分隔符，代替了默认的“/”分隔符。表示把所有10替换成100。
</p>
</div>
</li>

<li><a id="org86350bd"></a>选定行的范围：逗号<br />
<div class="outline-text-5" id="text-org86350bd">
<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #daa520;">'/test/,/check/p'</span> exampl
</pre>
</div>

<p>
所有在模板test和check所确定的范围内的行都被打印。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #daa520;">'5,/^test/p'</span> example
</pre>
</div>

<p>
打印从第五行开始到第一个包含以test开始的行之间的所有行。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/test/,/check/s/$/sed test/'</span> example
</pre>
</div>

<p>
对于模板test和west之间的行，每行的末尾用字符串sed test替换。
</p>
</div>
</li>

<li><a id="org8c3d7ad"></a>多点编辑：e命令<br />
<div class="outline-text-5" id="text-org8c3d7ad">
<div class="org-src-container">
<pre class="src src-shell">$ sed -e <span style="color: #daa520;">'1,5d'</span> -e <span style="color: #daa520;">'s/test/check/'</span>example
</pre>
</div>

<p>
(-e)选项允许在同一行里执行多条命令。如例子所示，第一条命令删除1至5行，第二条命令用check替换test。命令的执行顺序对结果有影响。如果两个命令都是替换命令，那么第一个替换命令将影响第二个替换命令的结果。
</p>

<div class="org-src-container">
<pre class="src src-shell">$ sed --expression=<span style="color: #daa520;">'s/test/check/'</span> --expression=<span style="color: #daa520;">'/love/d'</span> example
</pre>
</div>

<p>
一个比-e更好的命令是–expression。它能给sed表达式赋值。
</p>
</div>
</li>

<li><a id="org75ac09f"></a>从文件读入：r命令<br />
<div class="outline-text-5" id="text-org75ac09f">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/test/r file'</span> example
</pre>
</div>

<p>
file里的内容被读进来，显示在与test匹配的行后面，如果匹配多行，则file的内容将显示在所有匹配行的下面。
</p>
</div>
</li>

<li><a id="org7bac450"></a>写入文件：w命令<br />
<div class="outline-text-5" id="text-org7bac450">
<div class="org-src-container">
<pre class="src src-shell">$ sed -n <span style="color: #daa520;">'/test/w file'</span> example
</pre>
</div>

<p>
在example中所有包含test的行都被写入file里。
</p>
</div>
</li>

<li><a id="org6f22ebb"></a>追加命令：a命令<br />
<div class="outline-text-5" id="text-org6f22ebb">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/^test/a\\---&gt;this is a example'</span> example&lt;
</pre>
</div>

<p>
‘this is a example’被追加到以test开头的行后面，sed要求命令a后面有一个反斜杠。
</p>
</div>
</li>

<li><a id="org2b68bfe"></a>插入：i命令<br />
<div class="outline-text-5" id="text-org2b68bfe">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/test/i\\</span>
<span style="color: #daa520;">new line</span>
<span style="color: #daa520;">-------------------------'</span> example
</pre>
</div>

<p>
如果test被匹配，则把反斜杠后面的文本插入到匹配行的前面。
</p>
</div>
</li>

<li><a id="orga332d31"></a>下一个：n命令<br />
<div class="outline-text-5" id="text-orga332d31">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'/test/{ n; s/aa/bb/; }'</span> example
</pre>
</div>

<p>
如果test被匹配，则移动到匹配行的下一行，替换这一行的aa，变为bb，并打印该行，然后继续。
</p>
</div>
</li>

<li><a id="orgd16ff88"></a>变形：y命令<br />
<div class="outline-text-5" id="text-orgd16ff88">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'1,10y/abcde/ABCDE/'</span> example
</pre>
</div>

<p>
把1–10行内所有abcde转变为大写，注意，正则表达式元字符不能使用这个命令。
</p>
</div>
</li>

<li><a id="org7240713"></a>退出：q命令<br />
<div class="outline-text-5" id="text-org7240713">
<div class="org-src-container">
<pre class="src src-shell">$ sed <span style="color: #daa520;">'10q'</span> example
</pre>
</div>

<p>
打印完第10行后，退出sed。
</p>
</div>
</li>

<li><a id="orgcfd84be"></a>保持和获取：h命令和G命令<br />
<div class="outline-text-5" id="text-orgcfd84be">
<div class="org-src-container">
<pre class="src src-shell">$ sed -e <span style="color: #daa520;">'/test/h'</span> -e <span style="color: #daa520;">'$Gexample</span>
</pre>
</div>

<p>
在sed处理文件的时候，每一行都被保存在一个叫模式空间的临时缓冲区中，除非行被删除或者输出被取消，否则所有被处理的行都将打印在屏幕上。接着模式空间被清空，并存入新的一行等待处理。在这个例子里，匹配test的行被找到后，将存入模式空间，h命令将其复制并存入一个称为保持缓存区的特殊缓冲区内。第二条语句的意思是，当到达最后一行后，G命令取出保持缓冲区的行，然后把它放回模式空间中，且追加到现在已经存在于模式空间中的行的末尾。在这个例子中就是追加到最后一行。简单来说，任何包含test的行都被复制并追加到该文件的末尾。
</p>
</div>
</li>

<li><a id="org0bede23"></a>保持和互换：h命令和x命令<br />
<div class="outline-text-5" id="text-org0bede23">
<div class="org-src-container">
<pre class="src src-shell">$ sed -e <span style="color: #daa520;">'/test/h'</span> -e <span style="color: #daa520;">'/check/x'</span> example
</pre>
</div>

<p>
互换模式空间和保持缓冲区的内容。也就是把包含test与check的行互换。
</p>
</div>
</li>

<li><a id="orga267434"></a>Ref<br />
<div class="outline-text-5" id="text-orga267434">
<ul class="org-ul">
<li><a href="http://www.frostsky.com/2014/01/linux-sed-command/">http://www.frostsky.com/2014/01/linux-sed-command/</a></li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
